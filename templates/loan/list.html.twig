{% extends 'base.html.twig' %}

{% block title %}{{ parent() }} | Liste des emprunts{% endblock %}

{% block body %}
    {{ parent() }}
    <br>
    <a href="{{ path('loan_add') }}" title="ajouter un site">Faire une demande d'emprunts</a>
    <table id="table" 
        class="table table-hover" 
        data-toggle="table" 
        data-filter-control="true"
        data-click-to-select="true">
        <thead>
            <tr>
            <th data-field="driver_id" data-filter-control="select">Conducteur</th>
            <th data-field="destination_address" data-filter-control="select">Addresse de destination</th>
            <th data-field="depart_date" data-filter-control="select">Date de départ</th>
            <th data-field="return_date" data-filter-control="select">date d'arrivée</th>
            <th date-field="affected_vehicle_id" data-filter-control="select">Voiture</th>
            <th date-field="affected_return_vehicle" data-filter-control="select">Voiture rendue</th>
            <th date-field="affected_return_key" data-filter-control="select">Clé rendue</th>
            <th date-field="statut" data-filter-control="select">Statut</th>
            <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for loan in loans %}
            <tr>
            <td>{{ loan.driver.firstName }} {{ loan.driver.lastName }}</td>
            <td>{{ loan.destinationAddress }} - {{ loan.destinationCity }} - {{ loan.destinationCp }}</td>
            <td>{{ loan.departDate|date("d/m/Y") }}</td>
            <td>{{ loan.returnDate|date("d/m/Y") }}</td>
            <td>{{ loan.affectedVehicle.brand }} - {{ loan.affectedVehicle.model }}</td>
            <td>{% if loan.returnVehicle %}<i class="bi bi-check-lg"></i>{% else %}<i class="bi bi-x-lg"></i>{% endif %}</td>
            <td>{% if loan.returnKey %}<i class="bi bi-check-lg"></i>{% else %}<i class="bi bi-x-lg"></i>{% endif %}</td>
            <td>{{ loan.statut }}</td>
            <td>
            {% if loan.statut == "En validation" %}
              {% if is_granted('ROLE_ADMIN') %}
                <a class="btn btn-success" href="" >Valider</a><a class="btn btn-danger" href="">Refuser</a>
              {% endif %}
            {% elseif loan.statut == 'Validé' %}
              {% if not loan.returnVehicle %}
                <a class="btn btn-primary" href="" >Voiture rendu</a>
              {% endif %}
              {% if not loan.returnKey %}
                <a class="btn btn-primary" href="" >Clé rendu</a>
              {% endif %}
            <a class="btn btn-danger" href="{{ path('loan_annuler',{'id':loan.id}) }}">Annuler</a>
            {% endif %}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}
{% block javascripts %}{{ parent() }} 
<link href="https://unpkg.com/bootstrap-table@1.21.0/dist/bootstrap-table.min.css" rel="stylesheet">

<script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
<script src="https://unpkg.com/bootstrap-table@1.21.0/dist/bootstrap-table.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.21.0/dist/extensions/filter-control/bootstrap-table-filter-control.min.js"></script>
<script>
var $table = $('#table');
$(function () {
  $('#toolbar').find('select').change(function () {
    $table.bootstrapTable('refreshOptions', {
      exportDataType: $(this).val()
    });
  });
})
</script>
{% endblock %}